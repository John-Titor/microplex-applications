Functional requirements:
  ✔ react to BMW brake light message @done (21-04-13 20:05)
  ✔ react to BMW lighting message (rain = rear fog) @done (21-04-13 20:32)
  ✔ report 0-5V signal from AI_1 / fuel level sensor via BMW fuel level message @done (21-04-13 20:37)
  ✔ report status, temperature, T30 voltage via CAN (for diagnostics) @done (21-04-13 20:37)
  ☐ emulate the E90 JBE / CAS sufficient for Protools / XHP
  ☐ power-up on T15, power-down when off
  ☐ on CAN timeout, blink left/right slowly
  ✔ brake lights blink quickly when activated (and have been off for > 4s) @done (21-04-13 20:05)

Assembly requirements:
  Pins:
    1: ground
    2: fuel 0-5V
    3: T30
    4: CANL
    5: CANH
    6: T15 (TBD)
    7: T30
    8: NC
    9: T15 out (TBD)
    10: tail/rain lights
    11: brake lights 1
    12: brake lights 2

  Fuse: 10A
  Brake lights: ~700mA per circuit
  Tail lights: ~300mA total

Outputs:
  ☐ switch on/off as commanded
  ☐ detect over-current conditions
  ☐ detect open-circuit conditions

Brake lights:
  msgid 0xa8 - http://www.loopybunny.co.uk/CarPC/can/0A8.html
  two circuits for redundancy / patterns
  ✔ off when commanded off @done (21-04-13 20:05)
  ☐ report whether on / off via CAN
  ✔ turn-on sequence when commanded on @done (21-04-13 20:05)
    rapid alternation between circuits 1 & 2 for ~1s max
    only if have been off for > 4s
  ☐ blink slowly left/right on CAN timeout

Tail lights:
  msgid 0x21a - http://www.loopybunny.co.uk/CarPC/can/21A.html
  generated by PDM
  one circuit only
  ✔ on steady for tail light @done (21-04-13 20:06)
  ✔ blink 2Hz for rain light @done (21-04-13 20:06)
  ✔ rain has priority over tail @done (21-04-13 20:06)
  ☐ report whether on/off via CAN

Rain light:
  one circuit only, implementation TBD
  ☐ blinks at 4Hz in "rain" mode

Fuel level:
    msgid 0x349 - http://www.loopybunny.co.uk/CarPC/can/349.html
    full is 0x8000 per side
  ☐ send at 2Hz

Faults:
  ✔ two copies of each fault; "current" and "stored" @done (21-02-13 17:55)
  ✔ report via CAN @done (21-02-13 17:55)

CAN output:
  ✔ status message 1 @done (21-04-13 20:38)
    msgid 0x0f00000
    - T30 voltage
    - T15 voltage
    - temperature
    - fuel level

  ✔ status message 2 @done (21-04-13 20:38)
    msgid 0x0f00001
    - output current
    - output voltage

  ✔ fault message @done (21-04-13 20:38)
    msgid 0x0f00010
    - output faults, current & saved
    - system faults, current & saved

E90 CAS / JBE emulation:
  ☐ generate 0x130 CAN messages with appropriate ignition status
  ☐ respond to 0x6fe CAN messages as necessary to placate Protools / XHP

Test harness:
  ✔ log console messages @done (21-04-18 19:58)
  ✔ log CAN messages in verbose mode @done (21-04-18 19:58)
  ☐ decode internal status messages
  ☐ send brake status messages
  ☐ send light status messages
  ✔ control T15 @done (21-04-18 19:58)

Issues:
  ☐ non-extended-id CAN frames don't send
