Functional requirements:
  ✔ react to BMW brake light message @done (21-04-13 20:05)
  ✔ react to BMW lighting message (rain = rear fog) @done (21-04-13 20:32)
  ☐ report 0-5V signal from AI_1 / fuel level sensor via BMW fuel level message
  ☐ report status, temperature, T30 voltage via CAN (for diagnostics)
  ☐ emulate the E90 JBE / CAS sufficient for Protools / XHP
  ☐ power-up on T15, power-down when off
  ✔ on CAN timeout, blink left/right slowly @done (21-04-20 19:28)
  ✔ brake lights blink quickly when activated (and have been off for > 4s) @done (21-04-13 20:05)

Assembly requirements:
  Pins:
    1: ground
    2: fuel 0-5V
    3: T30
    4: CANL
    5: CANH
    6: T15 (TBD)
    7: NC
    8: NC
    9: NC (rain light?)
    10: tail/rain lights
    11: brake lights 1
    12: brake lights 2

  Fuse: 10A
  Brake lights: ~700mA per circuit
  Tail lights: ~300mA total

CAN:
  ✔ send standard frame @done (21-04-20 11:59)
  ✔ send extended frame @done (21-04-20 11:59)
  ✔ receive standard frame and match ID @done (21-04-20 11:59)
  ✔ filter specific message IDs @done (21-04-20 20:01)
  ☐ 500kbps

Outputs:
  ✔ switch on/off as commanded @done (21-04-20 17:25)
  ☐ detect over-current conditions
  ✔ detect open-circuit conditions @done (21-04-21 20:16)
  ✔ report output voltage @done (21-04-20 17:26)
  ✔ report output current @done (21-04-20 17:26)

Brake lights:
  msgid 0xa8 - http://www.loopybunny.co.uk/CarPC/can/0A8.html
  two circuits for redundancy / patterns
  ✔ off when commanded off @done (21-04-13 20:05)
  ✔ report whether on / off via CAN @done (21-04-20 14:03)
  ✔ turn-on sequence when commanded on @done (21-04-20 19:28)
    rapid alternation between circuits 1 & 2 for ~1s max
    only if have been off for > 4s
  ✔ blink slowly left/right on CAN timeout @done (21-04-20 19:27)

Tail lights:
  msgid 0x21a - http://www.loopybunny.co.uk/CarPC/can/21A.html
  generated by PDM
  one circuit only
  ✔ on steady for tail light @done (21-04-13 20:06)
  ✔ blink 2Hz for rain light @done (21-04-13 20:06)
  ✔ rain has priority over tail @done (21-04-13 20:06)
  ✔ report whether on/off via CAN @done (21-04-20 17:26)

Rain light:
  one circuit only, implementation TBD
  ✔ blinks at 4Hz in "rain" mode @done (21-04-21 23:19)

Fuel level:
    msgid 0x349 - http://www.loopybunny.co.uk/CarPC/can/349.html
    full is 0x8000 per side
  ✔ send at 2Hz @done (21-04-19 13:05)
  ✔ tracks 0.5-4.5V input @done (21-04-20 17:26)
  ☐ check 0-5V mapping to %

Faults:
  ✔ two copies of each fault; "current" and "stored" @done (21-02-13 17:55)
  ✔ report via CAN @done (21-02-13 17:55)
  ☐ T15 plausibility
  ☐ over-temperature
  ✔ CAN timeout @done (21-04-20 19:02)

CAN output:
  ✔ status message 1 @done (21-04-20 17:27)
    msgid 0x0f00000
    ✘ T30 voltage @cancelled (21-04-20 17:32)
    ✔ T15 voltage @done (21-04-21 20:15)
    ☐ temperature
    ✔ fuel level @done (21-04-20 17:27)

  ✔ status message 2 @done (21-04-20 17:27)
    msgid 0x0f00001
    - output current
    ✔ output voltage @done (21-04-21 20:15)

  ✔ fault message @done (21-04-20 17:27)
    msgid 0x0f00010
    ✔ output faults, current & saved @done (21-04-21 20:15)
    ✔ system faults, current & saved @done (21-04-21 20:15)

E90 CAS / JBE emulation:
  ✔ generate 0x130 CAN messages with appropriate ignition status at 500ms intervals @done (21-04-20 12:17)
  ☐ respond to 0x6fe CAN messages as necessary to placate Protools / XHP

Test harness:
  ✔ log console messages @done (21-04-18 19:58)
  ✔ log CAN messages in verbose mode @done (21-04-18 19:58)
  ✔ decode internal status messages @done (21-04-20 17:27)
  ✔ send brake status messages @done (21-04-20 12:17)
  ✔ send light status messages @done (21-04-20 12:17)
  ✔ control T15 @done (21-04-18 19:58)

Issues:
  ✔ non-extended-id CAN frames not received by test harness @done (21-04-20 12:17)
  ✔ open fault not clearing when output switched off (should it? maybe on T15 off?) @done (21-04-21 20:15)
  ✔ stuck fault set on turn-off @done (21-04-21 20:16)
  ☐ T15 voltage reading low
  ✔ rain light not turning on @done (21-04-22 00:17)
  ☐ module temperature stuck at zero
  ☐ DSEG + OSEG overflow 0x100 -> erratic behaviour / failure

